<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="/Site%20Configuration" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Information here and there about the notes and the website">

  <meta property="og:site_name" content="My Digital Garden">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/assets/styles/styles.css">

  
  <meta property="og:description" content="Information here and there about the notes and the website"/>
  

  
  <meta property="og:title" content="Site Configuration">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2023-04-27T14:19:56+00:00">
  <meta property="article:author" content="/">
  

  <meta property="og:url" content="/Site%20Configuration" />

  

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/vendor/KatexStyle.css"/>

  <!-- JavaScript -->
  <script defer src="/assets/js/vendor/KatexScript.js"></script>
  <script defer src="/assets/js/vendor/KatexAutoRender.js"
          onload="renderMathInElement(document.body,{
    delimiters: [
      { left: '$$',  right: '$$',  display: true  },
      { left: '$',   right: '$',   display: false },
      { left: '\\[', right: '\\]', display: true  },
      { left: '\\(', right: '\\)', display: false }
  ]});">
  </script>

  <title>
    
      Site Configuration &mdash; My Digital Garden
    
  </title>
</head>

  <body>
    <div class="container">
      <nav class="side-nav"><div class="site-header">
    <a class="internal-link" href="/" id="home-link">My Digital Garden</a>
    <a id="hamburger-menu">
        <div class="menu-icon"></div>
        <div class="menu-icon center-menu-icon"></div>
        <div class="menu-icon"></div>
    </a>
</div>

<div class="side-nav-container">
    
    

    

        <div class="side-nav-feed">
            
            

            <a href="/AP%20Chemistry/AP%20Chemistry" class="nav-link">
                <div class="nav-title ">
                    AP Chemistry
                </div>
            </a>

            

            
                <img src="/assets/media/drop-down-arrow.png" class="drop-down-img"
                style="transform: rotate(0);"  alt="drop down arrow">
            

            

            
            
                <div class="child-wrapper"  style="display: none" >

                

                
                    <div class="side-nav-feed">
                
                    <a href="/AP%20Chemistry/Princeton%20Review%20Notes" class="nav-link">
                        <div class="nav-title child-link ">
                            Princeton Review Notes
                        </div>
                    </a>
    
                    </div>
                
                
                </div>
            

            

        </div>

    

        <div class="side-nav-feed">
            
            

            <a href="/Daily%20Notes/Daily%20Notes" class="nav-link">
                <div class="nav-title ">
                    Daily Notes
                </div>
            </a>

            

            
                <img src="/assets/media/drop-down-arrow.png" class="drop-down-img"
                style="transform: rotate(0);"  alt="drop down arrow">
            

            

            
            
                <div class="child-wrapper"  style="display: none" >

                

                
                    <div class="side-nav-feed">
                
                    <a href="/Daily%20Notes/2022-12-22" class="nav-link">
                        <div class="nav-title child-link ">
                            2022/12/22
                        </div>
                    </a>
    
                    </div>
                
                    <div class="side-nav-feed">
                
                    <a href="/Daily%20Notes/2022-12-23" class="nav-link">
                        <div class="nav-title child-link ">
                            2022/12/23
                        </div>
                    </a>
    
                    </div>
                
                    <div class="side-nav-feed">
                
                    <a href="/Daily%20Notes/2022-12-24" class="nav-link">
                        <div class="nav-title child-link ">
                            2022/12/24
                        </div>
                    </a>
    
                    </div>
                
                    <div class="side-nav-feed">
                
                    <a href="/Daily%20Notes/2022-12-25" class="nav-link">
                        <div class="nav-title child-link ">
                            2022/12/25
                        </div>
                    </a>
    
                    </div>
                
                
                </div>
            

            

        </div>

    

        <div class="side-nav-feed">
            
            

            <a href="/MIT%2018.06SC%20Linear%20Algebra/MIT%2018.06SC%20Linear%20Algebra" class="nav-link">
                <div class="nav-title ">
                    MIT 18.06SC Linear Algebra
                </div>
            </a>

            

            
                <img src="/assets/media/drop-down-arrow.png" class="drop-down-img"
                style="transform: rotate(0);"  alt="drop down arrow">
            

            

            
            
                <div class="child-wrapper"  style="display: none" >

                

                
                    <div class="side-nav-feed">
                
                    <a href="/MIT%2018.06SC%20Linear%20Algebra/Unit%20I" class="nav-link">
                        <div class="nav-title child-link ">
                            Unit I
                        </div>
                    </a>
    
                    </div>
                
                    <div class="side-nav-feed">
                
                    <a href="/MIT%2018.06SC%20Linear%20Algebra/Unit%20II" class="nav-link">
                        <div class="nav-title child-link ">
                            Unit II
                        </div>
                    </a>
    
                    </div>
                
                    <div class="side-nav-feed">
                
                    <a href="/MIT%2018.06SC%20Linear%20Algebra/Unit%20III" class="nav-link">
                        <div class="nav-title child-link ">
                            Unit III
                        </div>
                    </a>
    
                    </div>
                
                
                </div>
            

            

        </div>

    

        <div class="side-nav-feed">
            
            

            <a href="/Site%20Configuration" class="nav-link">
                <div class="nav-title  current-page ">
                    Site Configuration
                </div>
            </a>

            

            

            

            

            

        </div>

    

</div>

<noscript>
    <!-- if js isn't supported, show everything -->
    <style>
        .side-nav-container{
            display: block;
        }
        .child-wrapper{
            display: block !important;
        }
    </style>
    <footer style="justify-content: center; display: flex;">JS isn't enabled, goodluck with that.</footer>
</noscript>

<script type="text/javascript">

    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)

    // get all the buttons
    let collapsible = document.getElementsByClassName("drop-down-img");
    if (collapsible.length > 0){
        for (let i = 0; i < collapsible.length; i++){
            // when the button is clicked
            collapsible[i].onclick = function() {
                console.log(this.nextElementSibling);

                let childWrapper = this.nextElementSibling;
                if (childWrapper.style.display == "none" || !childWrapper.style.display){
                    childWrapper.style.display = "block";
                    collapsible[i].style.transform = "rotate(180deg)";
                }
                else if (childWrapper.style.display == "block"){
                    childWrapper.style.display = "none";
                    collapsible[i].style.transform = "rotate(0)";

                }
            }
        }
    }

    let hamburgerMenu = document.getElementById("hamburger-menu");
    let sideNavContainer = document.getElementsByClassName("side-nav-container")[0];

    hamburgerMenu.onclick = function() {
        sideNavContainer.style.display = (window.getComputedStyle(sideNavContainer).display == "none") ? "block" : "none";
    }

</script></nav>
      <div class="wrapper">
        <main><article>
  <div><a onclick="window.history.back();" class="back-button">
    <h5 class="meta-title">← BACK</h5>
  </a></div>
  <div>
    <h1>Site Configuration</h1>
  </div>

  <div id="notes-entry-container">
    <content>

      

      <html><body>
<header>
Information here and there about the notes and the website
</header>

<hr>

<h2 class="no_toc toc-heading" id="table-of-contents">Table of Contents</h2>
<ol id="markdown-toc">
  <li>
<a href="#basic-information" id="markdown-toc-basic-information">Basic Information</a>    <ol>
      <li><a href="#running-the-site-locally" id="markdown-toc-running-the-site-locally">Running the Site Locally</a></li>
      <li><a href="#pushing-to-github" id="markdown-toc-pushing-to-github">Pushing to GitHub</a></li>
    </ol>
  </li>
  <li>
<a href="#configuration" id="markdown-toc-configuration">Configuration</a>    <ol>
      <li><a href="#behavioral-configuration" id="markdown-toc-behavioral-configuration">Behavioral Configuration</a></li>
    </ol>
  </li>
  <li><a href="#a-pile-of-unorganized-reminders-and-notes" id="markdown-toc-a-pile-of-unorganized-reminders-and-notes">A Pile of Unorganized Reminders and Notes</a></li>
  <li>
<a href="#custom-plugins" id="markdown-toc-custom-plugins">Custom Plugins</a>    <ol>
      <li><a href="#order-of-plugins" id="markdown-toc-order-of-plugins">Order of Plugins</a></li>
    </ol>
  </li>
  <li><a href="#current-workflow" id="markdown-toc-current-workflow">Current Workflow</a></li>
  <li><a href="#to-dos" id="markdown-toc-to-dos">To-Dos</a></li>
</ol>
<hr>

<h2 id="basic-information">Basic Information</h2>

<p>This site is created using the static site generator <a href="https://jekyllrb.com" target="_blank">Jekyll</a>, modified from the <a href="https://github.com/maximevaillancourt/digital-garden-jekyll-template" target="_blank">Jekyll Digital Garden Theme</a>, inspired by the <a href="https://help.obsidian.md" target="_blank">Obsidian Help Page</a> and the Jekyll <a href="https://github.com/just-the-docs/just-the-docs" target="_blank">Just the Docs</a> theme. Visit the site repository <a href="https://github.com/andyw-0612/andyw-0612.github.io" target="_blank">here</a>.</p>

<p><br>
<img src="notes-media/homepage-sc.png" style="box-shadow:0 1px 2px rgba(0, 0, 0, 0.12), 0 3px 10px rgba(0, 0, 0, 0.08)" alt="Image Not Found">
<br></p>

<p>This will be where I put down my random thoughts and notes on the online courses I stroll through from time to time. This site is hosted through GitHub Pages and GitHub Actions. Due to Github not being compatible with Jekyll sites that have custom plugins, the site is pushed onto the <code class="language-plaintext highlighter-rouge">master</code> branch on Github but built through a <a href="https://github.com/andyw-0612/andyw-0612.github.io/blob/master/.github/workflows/main.yml" target="_blank">workflow</a> to the <code class="language-plaintext highlighter-rouge">gh-pages</code> branch as static <code class="language-plaintext highlighter-rouge">html</code>, <code class="language-plaintext highlighter-rouge">css</code>, and <code class="language-plaintext highlighter-rouge">javascript</code> files. The GitHub pages are built from that branch as opposed to the usual <code class="language-plaintext highlighter-rouge">master</code> branch.</p>

<p>A lot of customization went into building the website, and I’ll try my best to sort through and document everything for one day if my future self wants to come back.</p>

<h3 id="running-the-site-locally">Running the Site Locally</h3>

<p>If you have <a href="https://www.ruby-lang.org/en/" target="_blank">Ruby</a> and <a href="https://bundler.io" target="_blank">Bundler</a> installed, running the site is as simple as running the following commands.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">install
</span>bundle <span class="nb">exec </span>jekyll serve
</code></pre></div></div>

<blockquote class="callout info-callout">
  <div class="callout-title info-callout-title"> <div class="callout-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewbox="0 
                    0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-info"><circle cx="12" cy="12" r="10">
                    </circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
</div>Info</div>
  <p>For a more detailed tutorial on running Jekyll sites locally, visit the official Github Pages Documentation <a href="https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/testing-your-github-pages-site-locally-with-jekyll" target="_blank">here</a>.</p>

</blockquote>

<h3 id="pushing-to-github">Pushing to GitHub</h3>

<p>Every time a push/commit is performed, a Github workflow will be triggered, which builds the site at the directory set by the <code class="language-plaintext highlighter-rouge">destination</code> attribute in <code class="language-plaintext highlighter-rouge">_config.yml</code>. The <code class="language-plaintext highlighter-rouge">destination</code> attribute must be set to <code class="language-plaintext highlighter-rouge">./build</code>, or the GitHub workflow will not work. Everything in <code class="language-plaintext highlighter-rouge">./build</code> is then pushed to a separate branch, <code class="language-plaintext highlighter-rouge">gh-pages</code>, the branch from GitHub Pages that will deploy the site.</p>

<p>For future reference, the GitHub workflow can be found <a href="https://github.com/andyw-0612/jekyll-deploy-gh-pages" target="_blank">here</a>.</p>

<p>GitHub Actions uses YAML syntax to define the workflow. Each workflow is stored as a separate YAML file in your code repository in a directory named <code class="language-plaintext highlighter-rouge">.github/workflows</code>.</p>

<p>You can create an example workflow in your repository that automatically triggers a series of commands whenever code is pushed. The following workflow, which is the one that this website uses, builds a Jekyll site from the current branch and pushes it to another branch which can be deployed via GitHub Pages.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/main.yml</span>

<span class="na">name</span><span class="pi">:</span> <span class="s">jekyll-deploy-gh-pages</span>

<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span> 
  <span class="na">build_and_deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build &amp; Deploy to GitHub Pages</span>
        <span class="na">env</span><span class="pi">:</span> 
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="na">GITHUB_REPOSITORY</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_REPOSITORY }}</span>
          <span class="na">GITHUB_ACTOR</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_ACTOR }}</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">andyw-0612/jekyll-deploy-gh-pages@master</span>

</code></pre></div></div>

<h2 id="configuration">Configuration</h2>

<p>Global site settings are configured in <code class="language-plaintext highlighter-rouge">_config.yml</code>.</p>

<h3 id="behavioral-configuration">Behavioral Configuration</h3>

<p><code class="language-plaintext highlighter-rouge">use_html_extension</code>: if you use a static host that doesn’t support URLs that don’t end with <code class="language-plaintext highlighter-rouge">.html</code> (such as Neocities), try changing the <code class="language-plaintext highlighter-rouge">use_html_extension</code> value to <code class="language-plaintext highlighter-rouge">true</code> in the <code class="language-plaintext highlighter-rouge">_config.yml</code> file and restart the Jekyll server (or re-build the site). This adds a <code class="language-plaintext highlighter-rouge">.html</code> extension to note URLs and may resolve issues with links.</p>

<p><code class="language-plaintext highlighter-rouge">open_external_links_in_new_tab</code>: when set to <code class="language-plaintext highlighter-rouge">true</code>, external links open in new tabs. Set to <code class="language-plaintext highlighter-rouge">false</code> to open all links in the current tab.</p>

<p><code class="language-plaintext highlighter-rouge">embed_tweets</code>: when set to <code class="language-plaintext highlighter-rouge">true</code>, tweet URLs on their own lines will be replaced with a Twitter embed. The default value is <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h2 id="a-pile-of-unorganized-reminders-and-notes">A Pile of Unorganized Reminders and Notes</h2>

<ul>
  <li>
    <p>To use the <code class="language-plaintext highlighter-rouge">raw</code> tag to display liquid syntax for inline code, the <code class="language-plaintext highlighter-rouge">raw</code> and <code class="language-plaintext highlighter-rouge">endraw</code>  tags must be outside of the backticks which enclose the inline code block</p>
  </li>
  <li>
    <p>To embed math, wrap math stuff with single dollar signs $for \space inline \space math$ and double dollar signs for block math.</p>

    <div class="kdmath">$$
\int\limits_{0}^{1} \int\limits_{0}^{1} \int\limits_{0}^{1} xyz , dx , dy , dz
$$</div>
  </li>
  <li>
    <p>Refer to <a class="internal-link" href="/Daily%20Notes/2022-12-22">2022-12-22</a> for information on the title front matter.</p>
  </li>
  <li>
    <p>Internal links to another note can be written with the <code class="language-plaintext highlighter-rouge">[[Double Bracket]]</code> link syntax or the plain old <code class="language-plaintext highlighter-rouge">[markdown style](path/to/note)</code>.</p>
  </li>
  <li>
    <p>Wikilinks point directly to the note’s <code class="language-plaintext highlighter-rouge">title</code> attribute in the front matter. Currently, using the relative path to the notes is not supported.</p>
  </li>
  <li>
    <p>Liquid  <code class="language-plaintext highlighter-rouge">{% highlight %}</code>  will not work as one of the plugins that I wrote complies markdown files through the official Liquid library, which does not support the highlight tag, a custom feature implemented by Jekyll.</p>
  </li>
  <li>
    <p>Images can be embedded using the <code class="language-plaintext highlighter-rouge">![[Obsidian.png]]</code> syntax or the plain old <code class="language-plaintext highlighter-rouge">![markdown syntax](path/to/image)</code>. HTML <code class="language-plaintext highlighter-rouge">img</code> tags only work with images linked through URLs in Obsidian.</p>
  </li>
  <li>
    <p>Although for image embeds, Obsidian supports configuring the height and width properties of the image by using a pipe operator as such <code class="language-plaintext highlighter-rouge">![[image.png|height x width]]</code>, the Jekyll website cannot do so. Additionally, setting explicit height and width values makes the image incompatible with mobile devices due to the difference in screen ratio.</p>
  </li>
  <li>
    <p>It is possible to configure a description for each note by enclosing the text between HTML <code class="language-plaintext highlighter-rouge">header</code> tags at the top of the note. This description will be displayed as lighter-colored text under the note heading.</p>
  </li>
  <li>
    <p>To create a parent page with child pages, add the following line to the front matter of parent pages:</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="s">---</span>
  <span class="s">title</span><span class="pi">:</span> <span class="s">Note Title</span>
  <span class="na">has_children</span><span class="pi">:</span> <span class="no">true</span>
  <span class="s">---</span>
</code></pre></div>    </div>

    <p>On child pages, set the front matter attribute <code class="language-plaintext highlighter-rouge">has_parent</code> to their respective parent page’s <code class="language-plaintext highlighter-rouge">title</code>. Remember, the <code class="language-plaintext highlighter-rouge">has_parent</code> attribute must point to the parent page’s <code class="language-plaintext highlighter-rouge">title</code>, not the file name!</p>
  </li>
  <li>
    <p>At the end of every parent page, there will be an automatically generated table of content listing its child pages. Currently, there is no way of disabling it.</p>
  </li>
  <li>
    <p>Although not required, it is preferred to create a separate directory within <code class="language-plaintext highlighter-rouge">/_notes</code> to store the parent page along with its child pages.</p>
  </li>
  <li>
    <p>Kramdown, the markdown version that Jekyll uses, can generate an automatic table of contents for the headings in every note by placing the following lines at the start of every note (After <code class="language-plaintext highlighter-rouge">header</code> tags, if any).</p>

    <div class="language-markdown highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  ## Table of Contents
  {:.no_toc .toc-heading}
<span class="p">  1.</span> 
  {:toc}
</code></pre></div>    </div>
  </li>
  <li>
    <p>Visit Obsidian’s official <a href="https://help.obsidian.md/Obsidian/Index" target="_blank">documentation</a> for help on markdown syntax and everything else related to Obsidian.</p>
  </li>
</ul>

<blockquote class="callout warning-callout">
  <div class="callout-title warning-callout-title"> <div class="callout-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewbox="0 
                    0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-info"><circle cx="12" cy="12" r="10">
                    </circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
</div>Warning</div>
  <p>Callouts will not show up on the website unless there’s at least a line below it (blank or not, it does not matter)</p>

  <p>The custom Jekyll plugin I wrote for callouts needs some tweaking and debugging</p>
</blockquote>

<h2 id="custom-plugins">Custom Plugins</h2>

<p>Information and notes about the custom plugins I wrote for this site in Ruby.</p>

<h3 id="order-of-plugins">Order of Plugins</h3>

<p>Both <code class="language-plaintext highlighter-rouge">_plugins/obsidian_embeds.rb</code> and <code class="language-plaintext highlighter-rouge">_plugins/bidirectional_link_generator.rb</code> has a priority flag set to low and lowest, respectively.</p>

<p><code class="language-plaintext highlighter-rouge">obsidian_embeds</code> must run after all plugins except <code class="language-plaintext highlighter-rouge">bidirectional_link_generator</code> since <code class="language-plaintext highlighter-rouge">obsidian_embeds</code> convert the markdown content to HTML code. The <code class="language-plaintext highlighter-rouge">bidirectional_link_generator</code> plugin parses HTML content, while all other plugins directly parse the markdown content.</p>

<h2 id="current-workflow">Current Workflow</h2>

<p>Obsidian is used for note-taking with the <code class="language-plaintext highlighter-rouge">_notes</code> directory as the Obsidian vault. Images and media for notes are stored in <code class="language-plaintext highlighter-rouge">_notes/notes-media</code>. Visual Studio Code is used to add, commit, and push changes to the remote repository on GitHub. GitHub will automatically deploy the updated changes through GitHub Actions to GitHub Pages at <a href="https://andyw-0612.github.io" target="_blank">andyw-0612.github.io</a>.</p>

<h2 id="to-dos">To-Dos</h2>

<ul>
  <li>Implement heading anchor links; an example can be found <a href="https://github.com/allejo/jekyll-anchor-headings" target="_blank">here</a>.</li>
  <li>Implement support for markdown task lists.</li>
  <li>Revamp side navigation based on file structures instead of front matters.</li>
  <li>Revise the callout logic to be similar to the way in which Wikilinks and image embeds are parsed so that callouts within fenced code blocks will not be processed.</li>
  <li>Customize callouts.</li>
  <li>Embed Notes.</li>
  <li>Write an explanation/documentation explaining the custom plugins I wrote, which were not originally included in the <a href="https://github.com/maximevaillancourt/digital-garden-jekyll-template" target="_blank">Digital Garden</a> template.</li>
  <li>Add a markdown reference note as a child note of this note.</li>
  <li>Implement a site-wide search functionality using <code class="language-plaintext highlighter-rouge">lunar.js</code>.</li>
</ul>
</body></html>

      

      <p>This line appears after every note.</p>
      <p>Lost? Go back to the <a class="internal-link" href="/">homepage</a>? </p>
    </content>

    <side style="font-size: 0.9em">
      <hr>
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      

      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      
    </side>
  </div>
</article>

<style>
  .meta-title {
    font-size: 12px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin: 0.75em 0 0 0;
  }
  .back-button{
    padding: 0;
    line-height: normal;
    cursor: pointer;

  }
  .back-button:after{
    content:none;
  }
</style>
</main>
        <footer>This is the footer. Include anything you'd like here, like a link to an <a class="internal-link" href="/about">About</a> page.
</footer>
      </div>
    </div>
    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  var linkHistories = {};

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      if (!linkHistories[event.target.href]) {
        iframe.src = event.target.href
        iframe.onload = function() {
          tooltipContentHtml = ''
          tooltipContentHtml += '<div style="font-weight: bold; font-size: 1.3rem">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
          // some documents don't have the time element 
          if (iframe.contentWindow.document.querySelector('time')){
          tooltipContentHtml += '<div style="color:#56535d; font-size: 1rem">' + iframe.contentWindow.document.querySelector('time').innerHTML + '</div>'
          }
          tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

          tooltipContent.innerHTML = tooltipContentHtml
          linkHistories[event.target.href] = tooltipContentHtml

          tooltipWrapper.style.display = 'block';
          setTimeout(function() {
            tooltipWrapper.style.opacity = 1;
          }, 1)
        } 
      } else {
        tooltipContent.innerHTML = linkHistories[event.target.href]
        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }


      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content .internal-link').forEach(setupListeners);
</script>

  </body>
</html>